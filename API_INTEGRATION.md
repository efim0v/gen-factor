# Интеграция с BLUP API

## Что было сделано

### 1. Настроен Vite прокси и HTTP клиент
**Файлы:** `vite.config.ts`, `services/httpClient.ts`

- Настроен Vite proxy для обхода CORS
- Basic Authentication добавляется автоматически на уровне прокси
- Логин: `blup_user` / Пароль: `1AMoVtyg`
- Удаленный API: `http://92.50.154.150:45501/blup/api`
- Локальный путь: `/api` (проксируется на удаленный API)

### 2. Обновлены типы данных
**Файл:** `types.ts`

Добавлены новые интерфейсы для работы с API:
- `DatabaseOut` - структура базы данных
- `BreedOut` - структура породы
- `TraitOut` - структура признака
- `FactorOut` - структура фактора среды

### 3. Переработан API сервис
**Файл:** `services/api.ts`

Все методы теперь используют реальные эндпоинты:

#### `getDatabases()`
- **Эндпоинт:** `GET /meta/databases?group=bmk`
- **Возвращает:** Список доступных баз данных группы BMK

#### `getBreeds(dbCode)`
- **Эндпоинт:** `GET /meta/breeds?db={dbCode}`
- **Параметр:** код базы данных (например, "bmk_yy")
- **Возвращает:** Список пород для указанной БД

#### `getTraits(dbCode)`
- **Эндпоинт:** `GET /meta/traits?db={dbCode}`
- **Параметр:** код базы данных
- **Возвращает:** Список признаков для указанной БД

#### `getFactors(dbCode)`
- **Эндпоинт:** `GET /meta/factors?db={dbCode}`
- **Параметр:** код базы данных
- **Возвращает:** Список факторов среды для указанной БД

### 4. Обновлена логика приложения
**Файл:** `App.tsx`

Изменена логика загрузки данных:
- **Раньше:** Породы → Признаки → Факторы (каскадная зависимость)
- **Сейчас:** При выборе БД одновременно загружаются породы, признаки и факторы
- Это соответствует структуре API, где все сущности зависят только от БД

## Запуск приложения

```bash
# Установите зависимости
npm install

# Запустите dev сервер
npm run dev
```

Приложение откроется по адресу: http://localhost:3000

## Тестирование API

Создан файл `test-api.html` для тестирования подключения к API.
Откройте его в браузере через dev сервер.

## Что осталось реализовать

### 1. Анализ данных
Метод `runAnalysis()` пока возвращает mock-данные.
Необходимо:
- Уточнить эндпоинт для запуска анализа в API
- Реализовать отправку параметров анализа
- Обработать результаты анализа

### 2. Скачивание результатов
Метод `downloadResults()` пока возвращает mock-данные.
Необходимо:
- Уточнить эндпоинт для скачивания результатов
- Реализовать загрузку ZIP-архива

## Примеры запросов

### Через Vite proxy (в development режиме)
```bash
# Запустите dev сервер
npm run dev

# Получить базы данных
curl "http://localhost:3000/api/meta/databases?group=bmk"

# Получить породы
curl "http://localhost:3000/api/meta/breeds?db=bmk_yy"

# Получить признаки
curl "http://localhost:3000/api/meta/traits?db=bmk_yy"

# Получить факторы
curl "http://localhost:3000/api/meta/factors?db=bmk_yy"
```

### Напрямую к API (без прокси)
```bash
# Получить базы данных
curl -u blup_user:1AMoVtyg "http://92.50.154.150:45501/blup/api/meta/databases?group=bmk"

# Получить породы
curl -u blup_user:1AMoVtyg "http://92.50.154.150:45501/blup/api/meta/breeds?db=bmk_yy"

# Получить признаки
curl -u blup_user:1AMoVtyg "http://92.50.154.150:45501/blup/api/meta/traits?db=bmk_yy"

# Получить факторы
curl -u blup_user:1AMoVtyg "http://92.50.154.150:45501/blup/api/meta/factors?db=bmk_yy"
```

## Структура проекта

```
анализ-генетических-факторов/
├── services/
│   ├── httpClient.ts      # HTTP клиент с аутентификацией
│   └── api.ts             # API методы для работы с данными
├── components/
│   ├── UI.tsx             # UI компоненты
│   └── ResultsView.tsx    # Компонент результатов
├── App.tsx                # Главный компонент
├── types.ts               # TypeScript типы
└── index.tsx              # Точка входа
```

## CORS и безопасность

✅ **Решение CORS проблемы:**
В development режиме используется Vite proxy сервер, который:
- Проксирует все запросы с `/api` на `http://92.50.154.150:45501/blup/api`
- Автоматически добавляет Basic Authentication заголовки
- Обходит CORS ограничения браузера

⚠️ **Важно для продакшена:**
1. Настроить реверс-прокси (nginx/apache) на сервере
2. Использовать HTTPS
3. Хранить credentials в переменных окружения
4. Настроить CORS на API сервере или использовать прокси

## Документация API

Полная документация API доступна по адресу:
http://92.50.154.150:45501/blup/docs
