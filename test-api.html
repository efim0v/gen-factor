<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>API Test</title>
</head>
<body>
    <h1>API Connection Test</h1>
    <div id="results"></div>

    <script>
        const API_BASE_URL = 'http://92.50.154.150:45501/blup/api';
        const API_USERNAME = 'blup_user';
        const API_PASSWORD = '1AMoVtyg';

        const createAuthHeader = () => {
            const credentials = btoa(`${API_USERNAME}:${API_PASSWORD}`);
            return `Basic ${credentials}`;
        };

        async function testAPI() {
            const results = document.getElementById('results');

            try {
                // Test 1: Get Databases
                results.innerHTML += '<h2>Test 1: Get Databases</h2>';
                const dbResponse = await fetch(`${API_BASE_URL}/meta/databases?group=bmk`, {
                    headers: {
                        'Authorization': createAuthHeader()
                    }
                });
                const databases = await dbResponse.json();
                results.innerHTML += `<pre>${JSON.stringify(databases, null, 2)}</pre>`;

                // Test 2: Get Breeds for first database
                if (databases.length > 0) {
                    const dbCode = databases[0].code;
                    results.innerHTML += `<h2>Test 2: Get Breeds for ${dbCode}</h2>`;
                    const breedsResponse = await fetch(`${API_BASE_URL}/meta/breeds?db=${dbCode}`, {
                        headers: {
                            'Authorization': createAuthHeader()
                        }
                    });
                    const breeds = await breedsResponse.json();
                    results.innerHTML += `<pre>${JSON.stringify(breeds, null, 2)}</pre>`;

                    // Test 3: Get Traits for first database
                    results.innerHTML += `<h2>Test 3: Get Traits for ${dbCode}</h2>`;
                    const traitsResponse = await fetch(`${API_BASE_URL}/meta/traits?db=${dbCode}`, {
                        headers: {
                            'Authorization': createAuthHeader()
                        }
                    });
                    const traits = await traitsResponse.json();
                    results.innerHTML += `<pre>${JSON.stringify(traits, null, 2)}</pre>`;

                    // Test 4: Get Factors for first database
                    results.innerHTML += `<h2>Test 4: Get Factors for ${dbCode}</h2>`;
                    const factorsResponse = await fetch(`${API_BASE_URL}/meta/factors?db=${dbCode}`, {
                        headers: {
                            'Authorization': createAuthHeader()
                        }
                    });
                    const factors = await factorsResponse.json();
                    results.innerHTML += `<pre>${JSON.stringify(factors, null, 2)}</pre>`;
                }

                results.innerHTML += '<h2 style="color: green;">All tests passed!</h2>';
            } catch (error) {
                results.innerHTML += `<h2 style="color: red;">Error: ${error.message}</h2>`;
                console.error(error);
            }
        }

        testAPI();
    </script>
</body>
</html>
